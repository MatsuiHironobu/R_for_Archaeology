<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 ggplot2を使用したデータビジュアライゼーション | 考古学のための「R」入門</title>
  <meta name="description" content="4 ggplot2を使用したデータビジュアライゼーション | 考古学のための「R」入門" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="4 ggplot2を使用したデータビジュアライゼーション | 考古学のための「R」入門" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 ggplot2を使用したデータビジュアライゼーション | 考古学のための「R」入門" />
  
  
  

<meta name="author" content="松井　広信" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="データの編集.html"/>
<link rel="next" href="引用参考文献.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> はじめに</a></li>
<li class="chapter" data-level="2" data-path="統計解析言語r.html"><a href="統計解析言語r.html"><i class="fa fa-check"></i><b>2</b> 統計解析言語「R」</a>
<ul>
<li class="chapter" data-level="2.1" data-path="統計解析言語r.html"><a href="統計解析言語r.html#rとは"><i class="fa fa-check"></i><b>2.1</b> 「R」とは</a></li>
<li class="chapter" data-level="2.2" data-path="統計解析言語r.html"><a href="統計解析言語r.html#rとrstudioの導入"><i class="fa fa-check"></i><b>2.2</b> 「R」と「RStudio」の導入</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="データの編集.html"><a href="データの編集.html"><i class="fa fa-check"></i><b>3</b> データの編集</a>
<ul>
<li class="chapter" data-level="3.1" data-path="データの編集.html"><a href="データの編集.html#概要"><i class="fa fa-check"></i><b>3.1</b> 概要</a></li>
<li class="chapter" data-level="3.2" data-path="データの編集.html"><a href="データの編集.html#rの演算子について"><i class="fa fa-check"></i><b>3.2</b> 「R」の演算子について</a></li>
<li class="chapter" data-level="3.3" data-path="データの編集.html"><a href="データの編集.html#tidy-data"><i class="fa fa-check"></i><b>3.3</b> tidy data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="データの編集.html"><a href="データの編集.html#tidy-dataに変換する"><i class="fa fa-check"></i><b>3.3.1</b> tidy dataに変換する</a></li>
<li class="chapter" data-level="3.3.2" data-path="データの編集.html"><a href="データの編集.html#クロス集計表の変換"><i class="fa fa-check"></i><b>3.3.2</b> クロス集計表の変換</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="データの編集.html"><a href="データの編集.html#データを取り込む"><i class="fa fa-check"></i><b>3.4</b> データを取り込む</a></li>
<li class="chapter" data-level="3.5" data-path="データの編集.html"><a href="データの編集.html#filterによる行の絞り込み"><i class="fa fa-check"></i><b>3.5</b> <code>filter()</code>による行の絞り込み</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="データの編集.html"><a href="データの編集.html#一条件で絞り込む"><i class="fa fa-check"></i><b>3.5.1</b> 一条件で絞り込む</a></li>
<li class="chapter" data-level="3.5.2" data-path="データの編集.html"><a href="データの編集.html#複数条件による絞り込み"><i class="fa fa-check"></i><b>3.5.2</b> 複数条件による絞り込み</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="データの編集.html"><a href="データの編集.html#selectによる列の操作"><i class="fa fa-check"></i><b>3.6</b> <code>select()</code>による列の操作</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="データの編集.html"><a href="データの編集.html#列を抽出削除する"><i class="fa fa-check"></i><b>3.6.1</b> 列を抽出、削除する</a></li>
<li class="chapter" data-level="3.6.2" data-path="データの編集.html"><a href="データの編集.html#列の順番を入れ替える"><i class="fa fa-check"></i><b>3.6.2</b> 列の順番を入れ替える</a></li>
<li class="chapter" data-level="3.6.3" data-path="データの編集.html"><a href="データの編集.html#列のリネーム"><i class="fa fa-check"></i><b>3.6.3</b> 列のリネーム</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="データの編集.html"><a href="データの編集.html#mutateによる列の編集"><i class="fa fa-check"></i><b>3.7</b> <code>mutate()</code>による列の編集</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="データの編集.html"><a href="データの編集.html#mutate-による列の追加"><i class="fa fa-check"></i><b>3.7.1</b> mutate( )による列の追加</a></li>
<li class="chapter" data-level="3.7.2" data-path="データの編集.html"><a href="データの編集.html#場合分けによる列の編集"><i class="fa fa-check"></i><b>3.7.2</b> 場合分けによる列の編集</a></li>
<li class="chapter" data-level="3.7.3" data-path="データの編集.html"><a href="データの編集.html#文字列の置き換え"><i class="fa fa-check"></i><b>3.7.3</b> 文字列の置き換え</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="データの編集.html"><a href="データの編集.html#概要表"><i class="fa fa-check"></i><b>3.8</b> <code>summarize()</code>による概要表</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html"><i class="fa fa-check"></i><b>4</b> ggplot2を使用したデータビジュアライゼーション</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html#データ可視化の重要性"><i class="fa fa-check"></i><b>4.1</b> データ可視化の重要性</a></li>
<li class="chapter" data-level="4.2" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html#見た目を設定する"><i class="fa fa-check"></i><b>4.2</b> 見た目を設定する</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html#日本語フォントを探す"><i class="fa fa-check"></i><b>4.2.1</b> 日本語フォントを探す</a></li>
<li class="chapter" data-level="4.2.2" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html#見た目の設定"><i class="fa fa-check"></i><b>4.2.2</b> 見た目の設定</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html#ヒストグラム"><i class="fa fa-check"></i><b>4.3</b> ヒストグラム</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html#ヒストグラムとは"><i class="fa fa-check"></i><b>4.3.1</b> ヒストグラムとは</a></li>
<li class="chapter" data-level="4.3.2" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html#複数のヒストグラムを表示する"><i class="fa fa-check"></i><b>4.3.2</b> 複数のヒストグラムを表示する</a></li>
<li class="chapter" data-level="4.3.3" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html#グラフの情報を取得する"><i class="fa fa-check"></i><b>4.3.3</b> グラフの情報を取得する</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html#棒グラフ"><i class="fa fa-check"></i><b>4.4</b> 棒グラフ</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html#棒グラフ-1"><i class="fa fa-check"></i><b>4.4.1</b> 棒グラフ</a></li>
<li class="chapter" data-level="4.4.2" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html#帯グラフ"><i class="fa fa-check"></i><b>4.4.2</b> 帯グラフ</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html#円グラフ"><i class="fa fa-check"></i><b>4.5</b> 円グラフ</a></li>
<li class="chapter" data-level="4.6" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html#箱ひげ図"><i class="fa fa-check"></i><b>4.6</b> 箱ひげ図</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html#箱ひげ図-1"><i class="fa fa-check"></i><b>4.6.1</b> 箱ひげ図</a></li>
<li class="chapter" data-level="4.6.2" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html#バイオリンプロットシナプロット"><i class="fa fa-check"></i><b>4.6.2</b> バイオリンプロット／シナプロット</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="ggplot2を使用したデータビジュアライゼーション.html"><a href="ggplot2を使用したデータビジュアライゼーション.html#折れ線グラフ"><i class="fa fa-check"></i><b>4.7</b> 折れ線グラフ</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="引用参考文献.html"><a href="引用参考文献.html"><i class="fa fa-check"></i><b>5</b> 引用参考文献</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">考古学のための「R」入門</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ggplot2を使用したデータビジュアライゼーション" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> ggplot2を使用したデータビジュアライゼーション<a href="ggplot2を使用したデータビジュアライゼーション.html#ggplot2を使用したデータビジュアライゼーション" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="データ可視化の重要性" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> データ可視化の重要性<a href="ggplot2を使用したデータビジュアライゼーション.html#データ可視化の重要性" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>データの特徴を知るために概要表を作成が重要であることは前章で示しましたが、それだけでは十分ではありません。インターネットでデータの可視化の重要性を検索すると様々なメリットを知ることができます。論文等で明示されることは少ないようですが、鈴木・鈴村<span class="citation">(2015)</span>では以下の6点が指摘されています。</p>
<blockquote>
<ul>
<li>「データの持つ意味」を発見しやすくなる<br />
</li>
<li>状態（状況）の特徴が把握しやすくなる<br />
</li>
<li>数量の比較がしやすくなる<br />
</li>
<li>相関性が把握しやすくなる<br />
</li>
<li>変化（推移）が把握しやすくなる<br />
–鈴木・鈴村<span class="citation">(2015)</span>pp.474より</li>
</ul>
</blockquote>
<p><a href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a>の開発者らは、有名な統計学者のTukey氏の次の主張を引用しています<span class="citation">(Wickham &amp; Grolemund, 2017)</span>。</p>
<blockquote>
<p>The simple graph has brought more information to the data analyst’s mind than any other device.<br />
（意訳）シンプルな図は、他のどんな装置よりも多くの情報を私たちにもたらした。<br />
– Tukey<span class="citation">(1962)</span>pp.49より</p>
</blockquote>
<p>Tukey氏は「探索的データ解析（EDA:Explorary Data Analysis）」を提唱し、「箱ひげ図」などの直感的でわかりやすいグラフを提示したことで知られています。これらのメッセージからも可視化の重要性、メリットが端的に理解できるでしょう。</p>
<p>さて話題が脱線しつつありますが、ここで要約統計量だけでなく、データ可視化が重要であることを理解するために、<a href="http://www.thefunctionalart.com/2016/08/download-datasaurus-never-trust-summary.html"><code>Alberto Cairo</code></a>が作成・公開している<a href="https://cran.r-project.org/web/packages/datasauRus/vignettes/Datasaurus.html"><code>datasauRus</code></a>パッケージを利用します。このパッケージには13のグループと<span class="math inline">\(x\)</span>と<span class="math inline">\(y\)</span>データからなるデータセットが含まれており、それらは同じ平均と標準偏差、ピアソン相関係数を示しています。このうち3つのグループの要約統計量を示したものが表<a href="ggplot2を使用したデータビジュアライゼーション.html#tab:datasaurus-summary">4.1</a>です。このデータをプロットすると、恐竜 （<em>Anscombosaurus</em><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>）や星形、X字形が現れ、要約統計量は一致するにも関わらず、データの分布は全く異なることがわかります（図<a href="ggplot2を使用したデータビジュアライゼーション.html#fig:datasaurus-plot">4.1</a>）。<a href="https://www.research.autodesk.com/publications/same-stats-different-graphs/">Same Stats, Different Graphs</a>にアニメーションも掲載されているので、理解が深まるでしょう。</p>
<p>このように、平均や標準偏差といった基本的な要約統計量だけではデータ全体を把握することはできません。データの分布を可視化することで、より多くの情報を把握することができます。</p>
<table>
<caption><span id="tab:datasaurus-summary">表 4.1: </span>概要表</caption>
<thead>
<tr class="header">
<th align="left">dataset</th>
<th align="right">x_mean</th>
<th align="right">y_mean</th>
<th align="right">x_S.D.</th>
<th align="right">y_S.D.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dino</td>
<td align="right">54.3</td>
<td align="right">47.8</td>
<td align="right">16.8</td>
<td align="right">26.9</td>
</tr>
<tr class="even">
<td align="left">star</td>
<td align="right">54.3</td>
<td align="right">47.8</td>
<td align="right">16.8</td>
<td align="right">26.9</td>
</tr>
<tr class="odd">
<td align="left">x_shape</td>
<td align="right">54.3</td>
<td align="right">47.8</td>
<td align="right">16.8</td>
<td align="right">26.9</td>
</tr>
</tbody>
</table>
<div class="figure"><span style="display:block;" id="fig:datasaurus-plot"></span>
<img src="chapters_files/figure-html/datasaurus-plot-1.png" alt="可視化の重要性" width="672" />
<p class="caption">
図 4.1: 可視化の重要性
</p>
</div>
<p>可視化には<a href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a>パッケージを使います。<a href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a>では、レイヤーを重ねて、一つのグラフを作成します。レイヤーは、作成したグラフのデータ、グラフの種類（<code>geom_*()</code>関数）、見た目や位置調整などを組み合わせるもので、それぞれ<code>+</code>で連結させていきます。</p>
</div>
<div id="見た目を設定する" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> 見た目を設定する<a href="ggplot2を使用したデータビジュアライゼーション.html#見た目を設定する" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="日本語フォントを探す" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> 日本語フォントを探す<a href="ggplot2を使用したデータビジュアライゼーション.html#日本語フォントを探す" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><a href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a>で可視化するデータおよび図で日本語が含まれる場合、そのままの設定では表示されないので、あらかじめ使用するフォントを明示する必要があります。</p>
<p><code>systemfonts</code>パッケージの<a href="https://cran.r-project.org/web/packages/systemfonts/systemfonts.pdf"><code>systemfonts::system_fonts()</code></a>関数を使えば、システム中のフォントを調べることができます。この後<code>theme_*()</code>で使用する引数<code>base_family</code>で各自のPCにある日本語フォントを指定することで表示することができます。</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb43-1" tabindex="-1"></a><span class="co"># 日本語フォントを探し設定する。</span></span>
<span id="cb43-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb43-2" tabindex="-1"></a><span class="fu">library</span>(systemfonts)</span>
<span id="cb43-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb43-3" tabindex="-1"></a>fonts <span class="ot">&lt;-</span> systemfonts<span class="sc">::</span><span class="fu">system_fonts</span>()</span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-1" tabindex="-1"></a><span class="co"># 基本となる背景を作成</span></span>
<span id="cb44-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-2" tabindex="-1"></a>base <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>, <span class="dv">3</span>), </span>
<span id="cb44-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-3" tabindex="-1"></a>                   <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>, <span class="dv">3</span>),</span>
<span id="cb44-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-4" tabindex="-1"></a>                   <span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-5" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb44-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-6" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(x, y, <span class="at">color =</span> type, <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb44-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;x軸の名称を設定&quot;</span>,</span>
<span id="cb44-8"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-8" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;y軸の名称を設定&quot;</span>,</span>
<span id="cb44-9"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-9" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;theme( )での設定&quot;</span>,</span>
<span id="cb44-10"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-10" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;サブタイトル&quot;</span>,</span>
<span id="cb44-11"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-11" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">&quot;凡例の名称を設定&quot;</span>,   <span class="co"># `colour`で設定したものの名称変更</span></span>
<span id="cb44-12"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-12" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;凡例の名称を設定&quot;</span>,     <span class="co"># `fill`で設定したものの名称変更</span></span>
<span id="cb44-13"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-13" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;(このデータは...)&quot;</span>)</span>
<span id="cb44-14"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-14" tabindex="-1"></a></span>
<span id="cb44-15"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-15" tabindex="-1"></a>base <span class="sc">+</span></span>
<span id="cb44-16"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-16" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;日本語&quot;</span>, <span class="at">y =</span> <span class="st">&quot;個数&quot;</span>,</span>
<span id="cb44-17"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-17" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;`base_family =`で日本語を設定できる&quot;</span>) <span class="sc">+</span></span>
<span id="cb44-18"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-18" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb44-19"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-19" tabindex="-1"></a></span>
<span id="cb44-20"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-20" tabindex="-1"></a><span class="co"># 日本語に設定</span></span>
<span id="cb44-21"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-21" tabindex="-1"></a>base <span class="sc">+</span></span>
<span id="cb44-22"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-22" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;日本語&quot;</span>, <span class="at">y =</span> <span class="st">&quot;個数&quot;</span>,</span>
<span id="cb44-23"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-23" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;`base_family =`で日本語を設定できる&quot;</span>) <span class="sc">+</span></span>
<span id="cb44-24"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb44-24" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">&quot;HiraginoSans-W3&quot;</span>)         <span class="co"># 日本語を使用する場合</span></span></code></pre></div>
<p><img src="chapters_files/figure-html/unnamed-chunk-19-1.png" width="48%" /><img src="chapters_files/figure-html/unnamed-chunk-19-2.png" width="48%" /></p>
</div>
<div id="見た目の設定" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> 見た目の設定<a href="ggplot2を使用したデータビジュアライゼーション.html#見た目の設定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html"><code>theme_*()</code></a>は図の背景を設定することができます（図<a href="ggplot2を使用したデータビジュアライゼーション.html#fig:theme-plot">4.2</a>）。デフォルトでは<code>theme_grey</code>が設定されており、背景がグレーのタイルで表示されます。一般的な論文だとモノクロ印刷であるため<code>theme_bw()</code>、<code>theme_minimal()</code>、<code>theme_classic()</code>が適しています。この<a href="https://ggplot2.tidyverse.org/reference/ggtheme.html"><code>theme_*()</code></a>で使用できる引数は<code>base_size</code>（文字の大きさ）、<code>base_family</code>（フォント）、<code>base_line_size</code>（罫線）、<code>base_rect_size</code>（枠線）の4つに限られています。</p>
<p><a href="https://ggplot2.tidyverse.org/reference/theme.html"><code>theme()</code></a>を用いると、タイトル・ラベル・フォント・背景・罫線・凡例をさらに細かく設定でき、引数はそれに応じて多岐に渡ります（図<a href="ggplot2を使用したデータビジュアライゼーション.html#fig:theme-plot2">4.3</a>）。<a href="https://ggplot2.tidyverse.org/reference/element.html"><code>element_*()</code></a>とセットで使うことが多く、<code>element_blank()</code>（何も表示せず、スペースも差し込まない）、<code>element_rect()</code>（罫線と背景）、<code>element_line()</code>（線関係）、<code>element_text()</code>（文字関係）の4つがあります。</p>
<p><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html"><code>theme_*()</code></a>はセット販売とすれば、<a href="https://ggplot2.tidyverse.org/reference/theme.html"><code>theme()</code></a>は単品販売のようなものでしょうか。<a href="https://ggplot2.tidyverse.org/reference/ggtheme.html"><code>theme_*()</code></a>は<a href="https://ggplot2.tidyverse.org/reference/theme.html"><code>theme()</code></a>で上書きすることも可能ですので、基本的には<a href="https://ggplot2.tidyverse.org/reference/ggtheme.html"><code>theme_*()</code></a>を使い、必要に応じて変更するとよいと思います。表示にこだわりがある場合や、<a href="https://ggplot2.tidyverse.org/reference/ggtheme.html"><code>theme_*()</code></a>が論文の投稿規定等に合致しない場合などは、<a href="https://ggplot2.tidyverse.org/reference/theme.html"><code>theme()</code></a>を使って詳細に設定するとよいでしょう（図<a href="ggplot2を使用したデータビジュアライゼーション.html#fig:my-theme">4.4</a>）。</p>
<p><a href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a>の制作者らが<a href="https://ggplot2-book.org/themes">“ggplot2: Elegant Graphics for Data Analysis”で解説</a>を公開しているので参照してください<span class="citation">(Wickham, 2016)</span>。</p>
<div class="figure"><span style="display:block;" id="fig:theme-plot"></span>
<img src="chapters_files/figure-html/theme-plot-1.png" alt="`theme_*()`の表示例" width="48%" /><img src="chapters_files/figure-html/theme-plot-2.png" alt="`theme_*()`の表示例" width="48%" /><img src="chapters_files/figure-html/theme-plot-3.png" alt="`theme_*()`の表示例" width="48%" /><img src="chapters_files/figure-html/theme-plot-4.png" alt="`theme_*()`の表示例" width="48%" /><img src="chapters_files/figure-html/theme-plot-5.png" alt="`theme_*()`の表示例" width="48%" /><img src="chapters_files/figure-html/theme-plot-6.png" alt="`theme_*()`の表示例" width="48%" /><img src="chapters_files/figure-html/theme-plot-7.png" alt="`theme_*()`の表示例" width="48%" /><img src="chapters_files/figure-html/theme-plot-8.png" alt="`theme_*()`の表示例" width="48%" />
<p class="caption">
図 4.2: <code>theme_*()</code>の表示例
</p>
</div>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-1" tabindex="-1"></a><span class="co"># 基本のプロットに`theme()`を設定する</span></span>
<span id="cb45-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-2" tabindex="-1"></a>base <span class="sc">+</span></span>
<span id="cb45-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;x軸の名称を設定&quot;</span>,</span>
<span id="cb45-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-4" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;y軸の名称を設定&quot;</span>,</span>
<span id="cb45-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-5" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;theme( )での設定&quot;</span>) <span class="sc">+</span></span>
<span id="cb45-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-6" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;Osaka&quot;</span>,</span>
<span id="cb45-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-7" tabindex="-1"></a>                             <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>,</span>
<span id="cb45-8"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-8" tabindex="-1"></a>                             <span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb45-9"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-9" tabindex="-1"></a>                             <span class="at">size =</span> <span class="dv">14</span>),   <span class="co"># タイトルの設定</span></span>
<span id="cb45-10"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-10" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;HiraMaruProN-W4&quot;</span>,</span>
<span id="cb45-11"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-11" tabindex="-1"></a>                                    <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb45-12"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-12" tabindex="-1"></a>                                    <span class="at">size =</span> <span class="dv">11</span>),   <span class="co"># x軸の名前の設定</span></span>
<span id="cb45-13"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-13" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;HiraMaruProN-W4&quot;</span>,</span>
<span id="cb45-14"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-14" tabindex="-1"></a>                                    <span class="at">colour =</span> <span class="st">&quot;green&quot;</span>), <span class="co"># y軸の名前を消す</span></span>
<span id="cb45-15"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-15" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>,</span>
<span id="cb45-16"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-16" tabindex="-1"></a>                                        <span class="at">colour =</span>  <span class="st">&quot;black&quot;</span>,</span>
<span id="cb45-17"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-17" tabindex="-1"></a>                                        <span class="at">linewidth =</span> <span class="fl">0.2</span>),   <span class="co"># 罫線の主線の設定</span></span>
<span id="cb45-18"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-18" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>,</span>
<span id="cb45-19"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-19" tabindex="-1"></a>                                        <span class="at">colour =</span>  <span class="st">&quot;black&quot;</span>,</span>
<span id="cb45-20"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-20" tabindex="-1"></a>                                        <span class="at">linewidth =</span> <span class="fl">0.2</span>)    <span class="co"># 罫線の副線の設</span></span>
<span id="cb45-21"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb45-21" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:theme-plot2"></span>
<img src="chapters_files/figure-html/theme-plot2-1.png" alt="`theme()`の設定例" width="672" />
<p class="caption">
図 4.3: <code>theme()</code>の設定例
</p>
</div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-1" tabindex="-1"></a><span class="co"># `my_theme`に格納しておけば労力を省略できる。</span></span>
<span id="cb46-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-2" tabindex="-1"></a>my_theme <span class="ot">&lt;-</span> </span>
<span id="cb46-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-3" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;HiraginoSans-W3&quot;</span>,</span>
<span id="cb46-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-4" tabindex="-1"></a>                            <span class="at">size =</span> <span class="dv">9</span>),    <span class="co"># 日本語フォントの設定</span></span>
<span id="cb46-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-5" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),   <span class="co"># タイトルの設定</span></span>
<span id="cb46-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-6" tabindex="-1"></a>        <span class="co"># 軸（axis）関係</span></span>
<span id="cb46-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-7" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb46-8"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-8" tabindex="-1"></a>                                  <span class="at">size =</span> <span class="dv">9</span>),   <span class="co"># 軸の名称の設定</span></span>
<span id="cb46-9"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-9" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>,</span>
<span id="cb46-10"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-10" tabindex="-1"></a>                                        <span class="at">colour =</span>  <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb46-11"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-11" tabindex="-1"></a>                                        <span class="at">linewidth =</span> <span class="fl">0.2</span>),   <span class="co"># 罫線の主線の設定</span></span>
<span id="cb46-12"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-12" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>,</span>
<span id="cb46-13"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-13" tabindex="-1"></a>                                        <span class="at">colour =</span>  <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb46-14"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-14" tabindex="-1"></a>                                        <span class="at">linewidth =</span> <span class="fl">0.2</span>),   <span class="co"># 罫線の副線の設定</span></span>
<span id="cb46-15"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-15" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),                 <span class="co"># 背景を空白に設定</span></span>
<span id="cb46-16"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-16" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>,</span>
<span id="cb46-17"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-17" tabindex="-1"></a>                                    <span class="at">linewidth =</span> <span class="fl">0.5</span>,</span>
<span id="cb46-18"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-18" tabindex="-1"></a>                                    <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb46-19"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-19" tabindex="-1"></a>        <span class="co"># 凡例（legend）関係</span></span>
<span id="cb46-20"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-20" tabindex="-1"></a>        <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>,         <span class="co"># 水平にする</span></span>
<span id="cb46-21"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-21" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,              <span class="co"># 凡例の位置</span></span>
<span id="cb46-22"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-22" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb46-23"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-23" tabindex="-1"></a>        <span class="co"># キャプション（caption）関係</span></span>
<span id="cb46-24"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-24" tabindex="-1"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb46-25"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-25" tabindex="-1"></a>        <span class="co"># facet関係</span></span>
<span id="cb46-26"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-26" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>)  <span class="co"># `facet_wrap`等のタイトル</span></span>
<span id="cb46-27"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-27" tabindex="-1"></a>        )</span>
<span id="cb46-28"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-28" tabindex="-1"></a></span>
<span id="cb46-29"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb46-29" tabindex="-1"></a>base <span class="sc">+</span> my_theme</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:my-theme"></span>
<img src="chapters_files/figure-html/my-theme-1.png" alt="`theme()`で好みの見た目に設定できる" width="672" />
<p class="caption">
図 4.4: <code>theme()</code>で好みの見た目に設定できる
</p>
</div>
</div>
</div>
<div id="ヒストグラム" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> ヒストグラム<a href="ggplot2を使用したデータビジュアライゼーション.html#ヒストグラム" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ヒストグラムとは" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> ヒストグラムとは<a href="ggplot2を使用したデータビジュアライゼーション.html#ヒストグラムとは" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ヒストグラムは量的データの分布を把握するために用いられるグラフです。一見棒グラフによく似ていますが、ヒストグラムが量的データのうち連続データを用いるのに対し、棒グラフは離散データを使用するという違いがあります。</p>
<p><a href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a>では、<a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html"><code>ggplot2::geom_histogram</code></a>を使用します。<span class="math inline">\(x\)</span>軸にはPML（前上顎骨長）を、<span class="math inline">\(y\)</span>軸では相対度数（<code>density</code>）や個数（<code>count</code>）を設定します。少数のデータの場合は個数で表現した方が良い場合がありますが、異なるサイズのデータを比較する場合や分布の形状を比較する場合は相対度数で示した方が良いようです。</p>
<p>図<a href="ggplot2を使用したデータビジュアライゼーション.html#fig:hist">4.5</a>は、<a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html"><code>ggplot2::geom_histogram</code></a>のデフォルト設定で出力したもので、ここからレイヤーを重ねていくことで、より美しくわかりやすい可視化をすることができます。ビン数はデフォルトで30ですが、<code>bins</code>でビン数を指定することもできます。ビン数は計算で算出することもできます（スタージェスの公式など）。</p>
<p>考古学では先行研究の蓄積が前提となる場合がほとんどなので、それに準じる形でビン幅をを設定する場面が多いと思われます。ビン幅は<code>binwidth</code>で設定することができます。ビン幅の設定によっては見た目が変わってしまうことがあり、作成者の恣意的な解釈に沿った作図も可能となるため、ビン幅の設定やヒストグラムを読み取る際には留意しなければいけません。</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb47-1" tabindex="-1"></a>hist <span class="ot">&lt;-</span> fish <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb47-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb47-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb47-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> PML, <span class="at">y =</span> <span class="fu">after_stat</span>(count)))</span>
<span id="cb47-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb47-4" tabindex="-1"></a>hist</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:hist"></span>
<img src="chapters_files/figure-html/hist-1.png" alt="geom_histogramのデフォルト表示" width="672" />
<p class="caption">
図 4.5: geom_histogramのデフォルト表示
</p>
</div>
</div>
<div id="複数のヒストグラムを表示する" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> 複数のヒストグラムを表示する<a href="ggplot2を使用したデータビジュアライゼーション.html#複数のヒストグラムを表示する" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ヒストグラムで次元を追加する場合（グループ分け等）、事前にデータフレームの任意の列の型をcharacter型（文字）からfactor型（因子）に変換します。グラフの描写の中でも<code>levels =</code>で任意の順番に変更することもできます。</p>
<p>1つのグラフの中で複数の変数（グループなど）を表示する場合は、<code>position =</code>で描写方法を指定します。<code>stack</code>のほか、<code>identity</code>や<code>dodge</code>があります（図<a href="ggplot2を使用したデータビジュアライゼーション.html#fig:hist2">4.6</a>）。</p>
<p>一方、よく似た分布を示したデータの場合は、それぞれでヒストグラムを作成した方が見やすく、<a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html"><code>ggplot2::facet_wrap()</code></a>関数や、変数が多い場合は<a href="https://ggplot2.tidyverse.org/reference/facet_grid.html"><code>facet_grid()</code></a>関数で表現すると比較しやすくなります。多くの場合は<a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html"><code>facet_wrap()</code></a>関数で十分です（図<a href="ggplot2を使用したデータビジュアライゼーション.html#fig:hist3">4.7</a>）。</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-1" tabindex="-1"></a>hist_2 <span class="ot">&lt;-</span> fish <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Fish <span class="sc">==</span> <span class="st">&quot;クロダイ属&quot;</span>  <span class="sc">&amp;</span></span>
<span id="cb48-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-3" tabindex="-1"></a>                  Direction <span class="sc">==</span> <span class="st">&quot;左&quot;</span> <span class="sc">&amp;</span> </span>
<span id="cb48-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-4" tabindex="-1"></a>                  Period <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;1期&quot;</span>, <span class="st">&quot;2期&quot;</span>, <span class="st">&quot;3期&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb48-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-5" tabindex="-1"></a>                  PML <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-6" tabindex="-1"></a>  <span class="co"># `mutate_at`と`as.factor`を組み合わせて型を変更</span></span>
<span id="cb48-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">&quot;Period&quot;</span>, <span class="st">&quot;Fish&quot;</span>, <span class="st">&quot;Bone&quot;</span>), as.factor) <span class="sc">%&gt;%</span></span>
<span id="cb48-8"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-8" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb48-9"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> PML, </span>
<span id="cb48-10"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-10" tabindex="-1"></a>                              <span class="at">y =</span> <span class="fu">after_stat</span>(density),</span>
<span id="cb48-11"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-11" tabindex="-1"></a>                              <span class="at">fill =</span> Period),</span>
<span id="cb48-12"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-12" tabindex="-1"></a>                          <span class="at">binwidth =</span> <span class="dv">5</span>,          <span class="co"># bin幅の設定</span></span>
<span id="cb48-13"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-13" tabindex="-1"></a>                          <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,      <span class="co"># グラフの枠線の色</span></span>
<span id="cb48-14"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-14" tabindex="-1"></a>                          <span class="at">position =</span> <span class="st">&quot;stack&quot;</span>,    <span class="co"># 表示方法</span></span>
<span id="cb48-15"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-15" tabindex="-1"></a>                          <span class="at">boundary =</span> <span class="dv">0</span>) <span class="sc">+</span>        <span class="co"># ビンの境界を指定</span></span>
<span id="cb48-16"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-16" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;PML（mm）&quot;</span>) <span class="sc">+</span></span>
<span id="cb48-17"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-17" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">10</span>), </span>
<span id="cb48-18"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-18" tabindex="-1"></a>                     <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">50</span>)) <span class="sc">+</span>        <span class="co"># x軸の範囲を設定</span></span>
<span id="cb48-19"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-19" tabindex="-1"></a>  my_theme</span>
<span id="cb48-20"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-20" tabindex="-1"></a></span>
<span id="cb48-21"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb48-21" tabindex="-1"></a>hist_2</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:hist2"></span>
<img src="chapters_files/figure-html/hist2-1.png" alt="`position = &quot;stack&quot;`での描写" width="672" />
<p class="caption">
図 4.6: <code>position = "stack"</code>での描写
</p>
</div>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-1" tabindex="-1"></a>hist_3 <span class="ot">&lt;-</span> fish <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Fish <span class="sc">==</span> <span class="st">&quot;クロダイ属&quot;</span>  <span class="sc">&amp;</span></span>
<span id="cb49-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-3" tabindex="-1"></a>                  Direction <span class="sc">==</span> <span class="st">&quot;左&quot;</span> <span class="sc">&amp;</span> </span>
<span id="cb49-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-4" tabindex="-1"></a>                  Period <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;1期&quot;</span>, <span class="st">&quot;2期&quot;</span>, <span class="st">&quot;3期&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb49-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-5" tabindex="-1"></a>                  PML <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-6" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb49-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> PML, </span>
<span id="cb49-8"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-8" tabindex="-1"></a>                              <span class="at">y =</span> <span class="fu">after_stat</span>(density)),</span>
<span id="cb49-9"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-9" tabindex="-1"></a>                          <span class="at">binwidth =</span> <span class="dv">5</span>,     <span class="co"># bin幅の設定</span></span>
<span id="cb49-10"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-10" tabindex="-1"></a>                          <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>,   <span class="co"># グラフの塗りの色</span></span>
<span id="cb49-11"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-11" tabindex="-1"></a>                          <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,     <span class="co"># グラフの枠線の色</span></span>
<span id="cb49-12"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-12" tabindex="-1"></a>                          <span class="at">boundary =</span> <span class="dv">0</span>) <span class="sc">+</span>       <span class="co"># ビンの境界を指定</span></span>
<span id="cb49-13"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;PML（mm）&quot;</span>) <span class="sc">+</span></span>
<span id="cb49-14"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-14" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">10</span>), </span>
<span id="cb49-15"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-15" tabindex="-1"></a>                     <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>)) <span class="sc">+</span>        <span class="co"># x軸の範囲を設定</span></span>
<span id="cb49-16"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-16" tabindex="-1"></a>  my_theme <span class="sc">+</span></span>
<span id="cb49-17"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-17" tabindex="-1"></a>  <span class="co"># facet_wrapで遺構毎に分割して表示する。</span></span>
<span id="cb49-18"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-18" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Period,</span>
<span id="cb49-19"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-19" tabindex="-1"></a>             <span class="co"># scales = &quot;free_y&quot;,      # y軸をそれぞれ設定する時</span></span>
<span id="cb49-20"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-20" tabindex="-1"></a>             <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb49-21"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-21" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">`</span><span class="at">1期</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;縄文1期&quot;</span>, </span>
<span id="cb49-22"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-22" tabindex="-1"></a>                                      <span class="st">`</span><span class="at">2期</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;縄文2期&quot;</span>, </span>
<span id="cb49-23"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-23" tabindex="-1"></a>                                      <span class="st">`</span><span class="at">3期</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;縄文3期&quot;</span> )))</span>
<span id="cb49-24"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-24" tabindex="-1"></a>  <span class="co">#as_labellerでラベル名を変更。``で明示することでエラーを回避。</span></span>
<span id="cb49-25"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-25" tabindex="-1"></a></span>
<span id="cb49-26"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb49-26" tabindex="-1"></a>hist_3</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:hist3"></span>
<img src="chapters_files/figure-html/hist3-1.png" alt="`facet_weap()`の描写" width="672" />
<p class="caption">
図 4.7: <code>facet_weap()</code>の描写
</p>
</div>
</div>
<div id="グラフの情報を取得する" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> グラフの情報を取得する<a href="ggplot2を使用したデータビジュアライゼーション.html#グラフの情報を取得する" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>また、表<a href="ggplot2を使用したデータビジュアライゼーション.html#tab:hist-build">4.2</a>のように<a href="https://ggplot2.tidyverse.org/reference/ggplot_build.html"><code>ggplot2::ggplot_build()</code></a>でggplot2で描写したグラフの情報を取得することも可能です。</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb50-1" tabindex="-1"></a>hist_info <span class="ot">&lt;-</span> hist_3 <span class="sc">%&gt;%</span> <span class="fu">ggplot_build</span>()</span>
<span id="cb50-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb50-2" tabindex="-1"></a>hist_info_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(hist_info<span class="sc">$</span>data)</span>
<span id="cb50-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb50-3" tabindex="-1"></a></span>
<span id="cb50-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb50-4" tabindex="-1"></a>hist_info_df <span class="sc">%&gt;%</span> </span>
<span id="cb50-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb50-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(PANEL, count, xmin, xmax, x, y, density) <span class="sc">%&gt;%</span></span>
<span id="cb50-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb50-6" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">9</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb50-7" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;作成したヒストグラムの情報&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:hist-build">表 4.2: </span>作成したヒストグラムの情報</caption>
<thead>
<tr class="header">
<th align="left">PANEL</th>
<th align="right">count</th>
<th align="right">xmin</th>
<th align="right">xmax</th>
<th align="right">x</th>
<th align="right">y</th>
<th align="right">density</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">2.5</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">10</td>
<td align="right">7.5</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">0</td>
<td align="right">10</td>
<td align="right">15</td>
<td align="right">12.5</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">2</td>
<td align="right">15</td>
<td align="right">20</td>
<td align="right">17.5</td>
<td align="right">0.0046512</td>
<td align="right">0.0046512</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">11</td>
<td align="right">20</td>
<td align="right">25</td>
<td align="right">22.5</td>
<td align="right">0.0255814</td>
<td align="right">0.0255814</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">44</td>
<td align="right">25</td>
<td align="right">30</td>
<td align="right">27.5</td>
<td align="right">0.1023256</td>
<td align="right">0.1023256</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">26</td>
<td align="right">30</td>
<td align="right">35</td>
<td align="right">32.5</td>
<td align="right">0.0604651</td>
<td align="right">0.0604651</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">3</td>
<td align="right">35</td>
<td align="right">40</td>
<td align="right">37.5</td>
<td align="right">0.0069767</td>
<td align="right">0.0069767</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">0</td>
<td align="right">40</td>
<td align="right">45</td>
<td align="right">42.5</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="棒グラフ" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> 棒グラフ<a href="ggplot2を使用したデータビジュアライゼーション.html#棒グラフ" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>先述した通りヒストグラムは量的データのうち連続データを示すものですが、棒グラフは量的データのうち離散データを示す際に用いるグラフです。棒グラフは棒の高さでデータの大小を示し、値の高低を判別する際に有効です。</p>
<div id="棒グラフ-1" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> 棒グラフ<a href="ggplot2を使用したデータビジュアライゼーション.html#棒グラフ-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><a href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a>では<a href="https://ggplot2.tidyverse.org/reference/geom_bar.html"><code>ggplot2::geom_bar()</code></a>で描写することができます。棒グラフで変数を追加する場合（グループを加える等）は<code>fill =</code>で変数を指定できます。これの機能を利用して帯グラフ（積み上げ棒グラフ）作成することもできます。</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb51-1" tabindex="-1"></a>bar <span class="ot">&lt;-</span> fish <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb51-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Period <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;1期&quot;</span>, <span class="st">&quot;2期&quot;</span>, <span class="st">&quot;3期&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb51-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb51-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> Period)) <span class="sc">+</span></span>
<span id="cb51-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb51-5" tabindex="-1"></a>  my_theme    <span class="co"># 日本語を使用する場合</span></span>
<span id="cb51-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb51-6" tabindex="-1"></a></span>
<span id="cb51-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb51-7" tabindex="-1"></a>bar</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:bar"></span>
<img src="chapters_files/figure-html/bar-1.png" alt="geom_barのデフォルト表示" width="672" />
<p class="caption">
図 4.8: geom_barのデフォルト表示
</p>
</div>
</div>
<div id="帯グラフ" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> 帯グラフ<a href="ggplot2を使用したデータビジュアライゼーション.html#帯グラフ" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>帯グラフを描写したい時も<a href="https://ggplot2.tidyverse.org/reference/geom_bar.html"><code>ggplot2::geom_bar()</code></a>を使い、<span class="math inline">\(y\)</span>軸いっぱいに引き伸ばす<code>position = "fill"</code>とパーセンテージで表示する<code>scale_y_continuous(labels = scales::percent)</code>を指定します。多くの場合は横方向が好ましいので<code>coord_flip()</code>も加えます。</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb52-1" tabindex="-1"></a>band <span class="ot">&lt;-</span> fish <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb52-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Period <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;1期&quot;</span>, <span class="st">&quot;2期&quot;</span>, <span class="st">&quot;3期&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb52-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb52-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb52-4" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> Period, <span class="at">fill =</span> Fish),</span>
<span id="cb52-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb52-5" tabindex="-1"></a>           <span class="at">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="sc">+</span>   <span class="co"># 帯グラフにする</span></span>
<span id="cb52-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb52-6" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb52-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb52-7" tabindex="-1"></a>  my_theme <span class="sc">+</span></span>
<span id="cb52-8"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb52-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),    <span class="co"># x軸のタイトルを消す</span></span>
<span id="cb52-9"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb52-9" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()     <span class="co"># y軸のタイトルを消す</span></span>
<span id="cb52-10"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb52-10" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb52-11"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb52-11" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb52-12"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb52-12" tabindex="-1"></a></span>
<span id="cb52-13"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb52-13" tabindex="-1"></a>band</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:bar2"></span>
<img src="chapters_files/figure-html/bar2-1.png" alt="帯グラフ" width="672" />
<p class="caption">
図 4.9: 帯グラフ
</p>
</div>
<p>割合の少ない項目は「その他」等にまとめた方が視認性が上がることが知られています。ここでは上位5つより下位の魚種を「その他」にまとめ、主要な捕獲対象となった魚種を調べます。</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-1" tabindex="-1"></a><span class="do">#### ラベルを作成する ####</span></span>
<span id="cb53-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-2" tabindex="-1"></a><span class="co"># 魚種の出土数トップ9を抽出</span></span>
<span id="cb53-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-3" tabindex="-1"></a>top5 <span class="ot">&lt;-</span> fish <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Period <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;1期&quot;</span>, <span class="st">&quot;2期&quot;</span>, <span class="st">&quot;3期&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb53-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(Fish) <span class="sc">%&gt;%</span>            <span class="co"># グループ化</span></span>
<span id="cb53-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(),        <span class="co"># 魚種の個数をカウント</span></span>
<span id="cb53-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-7" tabindex="-1"></a>                   <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>    <span class="co"># グループ解除しておく癖をつける。</span></span>
<span id="cb53-8"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-8" tabindex="-1"></a>                   ) <span class="sc">%&gt;%</span></span>
<span id="cb53-9"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">%&gt;%</span>      <span class="co"># `desc()`関数は降順に、`arrange()`関数で並べ替える。</span></span>
<span id="cb53-10"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-10" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span>                         <span class="co"># `top_n()`関数で上位のデータだけ抽出する</span></span>
<span id="cb53-11"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Fish =</span> <span class="fu">as.character</span>(Fish))  <span class="co"># top9$Fishがfactor型だと調子が悪い。</span></span>
<span id="cb53-12"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-12" tabindex="-1"></a></span>
<span id="cb53-13"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-13" tabindex="-1"></a><span class="do">##### 帯グラフに割り付ける ####</span></span>
<span id="cb53-14"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-14" tabindex="-1"></a>band_2 <span class="ot">&lt;-</span> fish <span class="sc">%&gt;%</span></span>
<span id="cb53-15"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Period <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;1期&quot;</span>, <span class="st">&quot;2期&quot;</span>, <span class="st">&quot;3期&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb53-16"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-16" tabindex="-1"></a>  <span class="fu">droplevels</span>() <span class="sc">%&gt;%</span></span>
<span id="cb53-17"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Fish =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(Fish <span class="sc">%in%</span> top5<span class="sc">$</span>Fish, </span>
<span id="cb53-18"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-18" tabindex="-1"></a>                               Fish, <span class="st">&quot;その他&quot;</span>),</span>
<span id="cb53-19"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-19" tabindex="-1"></a>                              <span class="at">levels =</span> <span class="fu">c</span>(top5<span class="sc">$</span>Fish, <span class="st">&quot;その他&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb53-20"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-20" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb53-21"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> Period,</span>
<span id="cb53-22"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-22" tabindex="-1"></a>                        <span class="at">fill =</span> Fish),</span>
<span id="cb53-23"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-23" tabindex="-1"></a>                    <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb53-24"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-24" tabindex="-1"></a>                    <span class="at">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="sc">+</span>   <span class="co"># 帯グラフにする</span></span>
<span id="cb53-25"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-25" tabindex="-1"></a>  <span class="co"># `scale_y_reverse()` はグラフのy軸を逆順に表示するための関数（見た目のみ）。</span></span>
<span id="cb53-26"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-26" tabindex="-1"></a>  <span class="co"># `breaks=`部分：y軸の目盛りを0から1まで、0.2刻みで設定します。</span></span>
<span id="cb53-27"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-27" tabindex="-1"></a>  <span class="co"># `labels=`部分：0から80まで、20刻みで目盛りを設定し、</span></span>
<span id="cb53-28"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-28" tabindex="-1"></a>  <span class="co"># それを逆順にしています（`rev()`関数を使用）</span></span>
<span id="cb53-29"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-29" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.0</span>, <span class="at">by =</span> <span class="fl">0.2</span>),</span>
<span id="cb53-30"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-30" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;100 %&quot;</span>, <span class="fu">rev</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">80</span>, <span class="at">by =</span> <span class="dv">20</span>)))) <span class="sc">+</span> </span>
<span id="cb53-31"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-31" tabindex="-1"></a>  my_theme <span class="sc">+</span></span>
<span id="cb53-32"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-32" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),    <span class="co"># x軸のタイトルを消す</span></span>
<span id="cb53-33"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-33" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),    <span class="co"># y軸のタイトルを消す</span></span>
<span id="cb53-34"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-34" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb53-35"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-35" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb53-36"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-36" tabindex="-1"></a></span>
<span id="cb53-37"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb53-37" tabindex="-1"></a>band_2</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:bar3"></span>
<img src="chapters_files/figure-html/bar3-1.png" alt="構成する種類をまとめた帯グラフ" width="672" />
<p class="caption">
図 4.10: 構成する種類をまとめた帯グラフ
</p>
</div>
<p>また、<a href="https://trevorldavis.com/R/ggpattern/dev/"><code>ggpattern</code></a>パッケージの<a href="https://trevorldavis.com/R/ggpattern/dev/reference/geom-docs.html"><code>ggpattern::geom_bar_pattern()</code></a>を使用すれば、論文で使うような水玉や斜線、網掛け線などのパターン表示をすることもできます。<a href="https://qiita.com/ocean_f/items/2b7243e4e19231d27713"><code>@ocean_fさんのQiita</code></a>で作例が公開されています。</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-1" tabindex="-1"></a><span class="do">#### 時期毎の集計表を作成し、割り付けるラベルを作成 ####</span></span>
<span id="cb54-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-2" tabindex="-1"></a>fish_summarize <span class="ot">&lt;-</span> fish <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Period <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;1期&quot;</span>, <span class="st">&quot;2期&quot;</span>, <span class="st">&quot;3期&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-4" tabindex="-1"></a>  <span class="fu">droplevels</span>() <span class="sc">%&gt;%</span>                           <span class="co"># 次の処理のために不要なレベルを削除しておく（重要）</span></span>
<span id="cb54-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-5" tabindex="-1"></a>  <span class="co">#`if_else()`関数で場合分けする。トップ5以外は&quot;その他&quot;としてまとめる。</span></span>
<span id="cb54-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-6" tabindex="-1"></a>  <span class="co">#`levels`引数に`top5$Fish`を指定して、top5の順序通りにする。</span></span>
<span id="cb54-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Fish =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(Fish <span class="sc">%in%</span> top5<span class="sc">$</span>Fish, </span>
<span id="cb54-8"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-8" tabindex="-1"></a>                                      Fish, <span class="st">&quot;その他&quot;</span>),</span>
<span id="cb54-9"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-9" tabindex="-1"></a>                              <span class="at">levels =</span> <span class="fu">c</span>(top5<span class="sc">$</span>Fish, <span class="st">&quot;その他&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb54-10"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(Fish, Period) <span class="sc">%&gt;%</span>         <span class="co"># グループ化</span></span>
<span id="cb54-11"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(),             <span class="co"># 時期毎の個数をカウント</span></span>
<span id="cb54-12"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-12" tabindex="-1"></a>                   <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>         <span class="co"># グループ解除しておく癖をつける。</span></span>
<span id="cb54-13"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-13" tabindex="-1"></a>                   ) <span class="sc">%&gt;%</span></span>
<span id="cb54-14"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(Period) <span class="sc">%&gt;%</span></span>
<span id="cb54-15"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pct =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count),    <span class="co"># 時期毎の割合を算出</span></span>
<span id="cb54-16"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-16" tabindex="-1"></a>                <span class="at">cum_pct =</span> <span class="fu">cumsum</span>(pct),       <span class="co"># 時期毎の累積割合を算出</span></span>
<span id="cb54-17"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-17" tabindex="-1"></a>                <span class="at">pct_label =</span> <span class="fu">format</span>(          <span class="co"># 時期毎のラベルを作成</span></span>
<span id="cb54-18"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-18" tabindex="-1"></a>                  <span class="fu">round</span>(pct <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>),       <span class="co"># `fotmat()`で小数点第1位まで表示</span></span>
<span id="cb54-19"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-19" tabindex="-1"></a>                  <span class="at">nsmall =</span> <span class="dv">1</span>)</span>
<span id="cb54-20"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-20" tabindex="-1"></a>                ) <span class="sc">%&gt;%</span> </span>
<span id="cb54-21"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-21" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span>                    <span class="co"># グループ解除しておく癖をつける。</span></span>
<span id="cb54-22"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-22" tabindex="-1"></a>  <span class="fu">arrange</span>(Period)                  <span class="co"># `desc()`関数がない場合は昇順になる。</span></span>
<span id="cb54-23"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-23" tabindex="-1"></a></span>
<span id="cb54-24"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-24" tabindex="-1"></a></span>
<span id="cb54-25"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-25" tabindex="-1"></a><span class="do">##### 論文風にする ####</span></span>
<span id="cb54-26"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-26" tabindex="-1"></a><span class="co"># `ggpattern::geom_bar_pattern`で論文風にできる。</span></span>
<span id="cb54-27"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-27" tabindex="-1"></a><span class="fu">library</span>(ggpattern)</span>
<span id="cb54-28"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-28" tabindex="-1"></a>band_3 <span class="ot">&lt;-</span> fish_summarize <span class="sc">%&gt;%</span> </span>
<span id="cb54-29"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-29" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb54-30"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-30" tabindex="-1"></a>  ggpattern<span class="sc">::</span><span class="fu">geom_bar_pattern</span>(<span class="fu">aes</span>(<span class="at">x =</span> Period,</span>
<span id="cb54-31"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-31" tabindex="-1"></a>                                  <span class="at">y =</span> pct,                 <span class="co"># `geom_bar_pattern`ではyを指定する必要がある。</span></span>
<span id="cb54-32"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-32" tabindex="-1"></a>                                  <span class="at">fill =</span> Fish,</span>
<span id="cb54-33"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-33" tabindex="-1"></a>                                  <span class="at">pattern =</span> Fish,</span>
<span id="cb54-34"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-34" tabindex="-1"></a>                                  <span class="at">pattern_spacing =</span> Fish, </span>
<span id="cb54-35"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-35" tabindex="-1"></a>                                  <span class="at">pattern_density =</span> Fish),</span>
<span id="cb54-36"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-36" tabindex="-1"></a>                              <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,             <span class="co"># グラフの線の色を設定</span></span>
<span id="cb54-37"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-37" tabindex="-1"></a>                              <span class="at">pattern_fill =</span> <span class="st">&quot;black&quot;</span>,      <span class="co"># パターンの線の色を設定</span></span>
<span id="cb54-38"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-38" tabindex="-1"></a>                              <span class="at">pattern_color =</span> <span class="cn">NA</span>,</span>
<span id="cb54-39"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-39" tabindex="-1"></a>                              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb54-40"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-40" tabindex="-1"></a>                              <span class="at">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="sc">+</span></span>
<span id="cb54-41"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-41" tabindex="-1"></a>  <span class="co"># 帯グラフのパターンを設定する</span></span>
<span id="cb54-42"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-42" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;Fish&quot;</span>,</span>
<span id="cb54-43"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-43" tabindex="-1"></a>                               <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey50&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;grey75&quot;</span>, </span>
<span id="cb54-44"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-44" tabindex="-1"></a>                                          <span class="st">&quot;white&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;grey95&quot;</span>),</span>
<span id="cb54-45"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-45" tabindex="-1"></a>                               <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">byrow =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb54-46"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-46" tabindex="-1"></a>  ggpattern<span class="sc">::</span><span class="fu">scale_pattern_manual</span>(<span class="at">name =</span> <span class="st">&quot;Fish&quot;</span>,</span>
<span id="cb54-47"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-47" tabindex="-1"></a>                                  <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;none&quot;</span>, <span class="st">&quot;stripe&quot;</span>, <span class="st">&quot;none&quot;</span>, </span>
<span id="cb54-48"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-48" tabindex="-1"></a>                                             <span class="st">&quot;circle&quot;</span>, <span class="st">&quot;crosshatch&quot;</span>, <span class="st">&quot;none&quot;</span>),</span>
<span id="cb54-49"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-49" tabindex="-1"></a>                                  <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">byrow =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb54-50"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-50" tabindex="-1"></a>  ggpattern<span class="sc">::</span><span class="fu">scale_pattern_density_manual</span>(<span class="at">name =</span> <span class="st">&quot;Fish&quot;</span>,</span>
<span id="cb54-51"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-51" tabindex="-1"></a>                                          <span class="at">values =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fl">0.1</span>, <span class="cn">NA</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="cn">NA</span>),</span>
<span id="cb54-52"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-52" tabindex="-1"></a>                                          <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">byrow =</span> <span class="cn">TRUE</span>))  <span class="sc">+</span></span>
<span id="cb54-53"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-53" tabindex="-1"></a>  ggpattern<span class="sc">::</span><span class="fu">scale_pattern_spacing_manual</span>(<span class="at">name =</span> <span class="st">&quot;Fish&quot;</span>,</span>
<span id="cb54-54"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-54" tabindex="-1"></a>                                          <span class="at">values =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fl">0.05</span>, <span class="cn">NA</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="cn">NA</span>),</span>
<span id="cb54-55"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-55" tabindex="-1"></a>                                          <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">byrow =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb54-56"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-56" tabindex="-1"></a>  <span class="co"># `scale_y_reverse()` はグラフのy軸を逆順に表示するための関数（見た目のみ）。</span></span>
<span id="cb54-57"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-57" tabindex="-1"></a>  <span class="co"># `breaks=`部分：y軸の目盛りを0から1まで、0.2刻みで設定します。</span></span>
<span id="cb54-58"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-58" tabindex="-1"></a>  <span class="co"># `labels=`部分：0から80まで、20刻みで目盛りを設定し、</span></span>
<span id="cb54-59"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-59" tabindex="-1"></a>  <span class="co"># それを逆順にしています（`rev()`関数を使用）</span></span>
<span id="cb54-60"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-60" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.0</span>, <span class="at">by =</span> <span class="fl">0.2</span>),</span>
<span id="cb54-61"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-61" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;100 %&quot;</span>, <span class="fu">rev</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">80</span>, <span class="at">by =</span> <span class="dv">20</span>)))) <span class="sc">+</span> </span>
<span id="cb54-62"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-62" tabindex="-1"></a>  my_theme <span class="sc">+</span></span>
<span id="cb54-63"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-63" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),    <span class="co"># x軸のタイトルを消す</span></span>
<span id="cb54-64"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-64" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),    <span class="co"># y軸のタイトルを消す</span></span>
<span id="cb54-65"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-65" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb54-66"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-66" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb54-67"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-67" tabindex="-1"></a></span>
<span id="cb54-68"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-68" tabindex="-1"></a><span class="co"># 帯グラフに配置するラベルと座標を設定する。</span></span>
<span id="cb54-69"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-69" tabindex="-1"></a>fish_summarize <span class="ot">&lt;-</span> fish_summarize <span class="sc">%&gt;%</span></span>
<span id="cb54-70"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-70" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span>                                            <span class="co"># グループを解除しておく。</span></span>
<span id="cb54-71"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-71" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">round</span>((<span class="dv">1</span> <span class="sc">-</span> cum_pct) <span class="sc">+</span> pct <span class="sc">/</span> <span class="dv">2</span> , <span class="dv">3</span>))           <span class="co"># `scale_y_reverse()` でy座標の見た目が反転しているので1から引く。</span></span>
<span id="cb54-72"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-72" tabindex="-1"></a></span>
<span id="cb54-73"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-73" tabindex="-1"></a></span>
<span id="cb54-74"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-74" tabindex="-1"></a><span class="co"># 作図・出力（library(ggtext)でラベルを設定）</span></span>
<span id="cb54-75"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-75" tabindex="-1"></a>band_3 <span class="sc">+</span> </span>
<span id="cb54-76"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-76" tabindex="-1"></a>  ggtext<span class="sc">::</span><span class="fu">geom_richtext</span>(<span class="fu">aes</span>(<span class="at">x =</span> fish_summarize<span class="sc">$</span>Period,</span>
<span id="cb54-77"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-77" tabindex="-1"></a>                            <span class="at">y =</span> fish_summarize<span class="sc">$</span>y,</span>
<span id="cb54-78"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-78" tabindex="-1"></a>                            <span class="at">label =</span> fish_summarize<span class="sc">$</span>pct_label),</span>
<span id="cb54-79"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-79" tabindex="-1"></a>                        <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>,                   <span class="co"># ラベルの塗りの設定</span></span>
<span id="cb54-80"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-80" tabindex="-1"></a>                        <span class="at">label.color =</span> <span class="cn">NA</span>,                 <span class="co"># ラベルの枠線の設定</span></span>
<span id="cb54-81"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-81" tabindex="-1"></a>                        <span class="at">size =</span> <span class="dv">3</span>,                         <span class="co"># 文字の大きさ</span></span>
<span id="cb54-82"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-82" tabindex="-1"></a>                        <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>,                <span class="co"># 文字の太さ</span></span>
<span id="cb54-83"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-83" tabindex="-1"></a>                        <span class="at">hjust =</span> <span class="fl">0.5</span>,                      <span class="co"># 上下の位置を設定</span></span>
<span id="cb54-84"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-84" tabindex="-1"></a>                        <span class="at">vjust =</span> <span class="fl">0.5</span>,                      <span class="co"># 左右の位置を設定</span></span>
<span id="cb54-85"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-85" tabindex="-1"></a>                        <span class="at">label.padding =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="st">&quot;lines&quot;</span>),  <span class="co"># ラベルの余白を設定</span></span>
<span id="cb54-86"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb54-86" tabindex="-1"></a>                        <span class="at">label.r =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>))       <span class="co"># ラベルの角の丸みを設定</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:bar4"></span>
<img src="chapters_files/figure-html/bar4-1.png" alt="geom_bar_patternでの論文風の帯グラフ" width="672" />
<p class="caption">
図 4.11: geom_bar_patternでの論文風の帯グラフ
</p>
</div>
<p><a href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a>の拡張機能である<a href="https://wilkelab.org/ggtext/"><code>ggtext::geom_richtext()</code></a>は、例えばテキストを太字、斜体にしたり、フォント、色、サイズを変更するなどの見た目の設定や、テキストを下付き文字や上付き文字として配置したり、簡単な画像を貼り付けたりすることができ、細かな設定もできます。<code>label.padding</code>はラベルの文字列と枠の間の余白を<code>unit()</code>を使って指定できる機能で、<code>label.r</code>はラベルの角の丸みを設定することができます。引数の使用例は<a href="https://www.anarchive-beta.com/entry/2022/12/08/131400#labelpadding引数">「からっぽのしょこ」さん</a>等の個人ブログを参照した方がわかりやすい。</p>
<p>なお、上記のような帯グラフはエクセルでも比較的簡単に作成できる一方、<a href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a>では非常に手間がかかるのが弱点です。あらかじめ1つフォーマットを作っておき、使い回しできるようにしておくと時間の短縮となって良いです。</p>
</div>
</div>
<div id="円グラフ" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> 円グラフ<a href="ggplot2を使用したデータビジュアライゼーション.html#円グラフ" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>円グラフは、データ全体を円形で、データ構成する各項目を円形を分割する扇形で表現したグラフで、通常は割合（パーセンテージ）で表示されます。円グラフはエクセルで簡単に作成できることから、割合を表現する方法として広く用いられていますが、学術研究では好ましくないことが指摘されています。</p>
<p>考古学では、石井<span class="citation">(2020)</span>が下記のRのヘルプを参照しつつ指摘しています（コンソールで<code>?pie</code>と入力すれば確認できます）。</p>
<blockquote>
<p>Pie charts are a very bad way of displaying information. The eye is good at judging linear measures and bad at judging relative areas. A bar chart or dot chart is a preferable way of displaying this type of data.<br />
（意訳）円グラフは情報を表示するのに非常に不適切な方法です。人間の目は線の長さを判断するのは得意ですが、相対的な面積を判断するのは苦手です。棒グラフやドットチャート（ドットプロット。ヒストグラムの一種）の方が、この種類のデータを表示するのに適しています。<br />
Cleveland (1985), page 264: “Data that can be shown by pie charts always can be shown by a dot chart. This means that judgements of position along a common scale can be made instead of the less accurate angle judgements.” This statement is based on the empirical investigations of Cleveland and McGill as well as investigations by perceptual psychologists.<br />
（意訳）Cleveland (1985)の264ページには次のように書かれている。「円グラフで表示できるデータは、常にドットチャートで表示することができる。これにより、より正確な位置の判断ができるようになり、角度の判断よりも正確性が向上する。」この主張は、ClevelandとMcGillの実証的な調査や知覚心理学者の調査に基づいている。</p>
</blockquote>
<p>米ワシントン大学の考古学者のBen Marwick氏が先行研究等をまとめたところによると、円グラフはカテゴリー間の比較では棒グラフに劣る一方、全体の割合の推定では円グラフは棒グラフと同程度正確であるとのことです<span class="citation">(Marwick, 2019)</span>。一概に円グラフが悪いということではなく、データの性質が最も把握できる表現方法を選択すべきということでしょう。</p>
<p>なお、<a href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a>では円グラフ専用の<code>geom_*()</code>関数はありませんが、<a href="https://ggplot2.tidyverse.org/reference/geom_bar.html"><code>ggplot2::geom_bar()</code></a>を利用して作成することができます。</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb55-1" tabindex="-1"></a>fish_summarize <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb55-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pct2 =</span> pct <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span>  <span class="co"># パーセンテージ表示するため</span></span>
<span id="cb55-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb55-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb55-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb55-4" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> pct2, <span class="at">fill =</span> Fish),</span>
<span id="cb55-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb55-5" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span>   </span>
<span id="cb55-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb55-6" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb55-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb55-7" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>() <span class="sc">+</span>                <span class="co"># 「そのほか」が左上に行くようにする。</span></span>
<span id="cb55-8"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb55-8" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Period) <span class="sc">+</span></span>
<span id="cb55-9"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb55-9" tabindex="-1"></a>  my_theme <span class="sc">+</span></span>
<span id="cb55-10"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb55-10" tabindex="-1"></a>  <span class="fu">theme</span>(                                 <span class="co"># themeの更新</span></span>
<span id="cb55-11"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb55-11" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">element_blank</span>(),              <span class="co"># 余計なラインを消す</span></span>
<span id="cb55-12"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb55-12" tabindex="-1"></a>    <span class="at">rect =</span> <span class="fu">element_blank</span>(),              <span class="co"># 余計な枠線を消す</span></span>
<span id="cb55-13"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb55-13" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  <span class="co"># 余計な罫線を消す</span></span>
<span id="cb55-14"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb55-14" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),        <span class="co"># 軸のタイトルを消す</span></span>
<span id="cb55-15"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb55-15" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_blank</span>()       <span class="co"># `facet_wrap`のパネルの枠線を消す</span></span>
<span id="cb55-16"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb55-16" tabindex="-1"></a>    ) </span></code></pre></div>
<p><img src="chapters_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
<div id="箱ひげ図" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> 箱ひげ図<a href="ggplot2を使用したデータビジュアライゼーション.html#箱ひげ図" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="箱ひげ図-1" class="section level3 hasAnchor" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> 箱ひげ図<a href="ggplot2を使用したデータビジュアライゼーション.html#箱ひげ図-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>箱ひげ図は「中央値」、「第1四分位数」、「第3四分位数」、「最小値」、「最大値」の5つ要約統計量を視覚的に表現するための図です。箱の両端は「第1四分位数」<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> （Q1）と「第3四分位数」（Q3）を示し、箱のことを「四分位範囲」といいます。箱中央にある線は「中央値」(Median)を示します。ひげの両端は「最小値」と「最大値」、その外側の点は「外れ値」を示します。</p>
<p>箱ひげ図は、アメリカの統計学者John Tukey氏が1977年に著書”Exploratory Data Analysis”で発表した比較的新しいグラフです。今日では、一般的な統計手法として広く使用されています。<a href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a>では<a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html?q=boxplot#null"><code>ggplot2::geom_boxplot()</code></a>で導出することができます。</p>
<p>なお、箱ひげ図は複数のピークを持つ分布を適切に表すことができないので、データの「分布」を説明したい場合は、ヒストグラムや後述のバイオリンプロット、シナプロットを使う必要があります。</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-1" tabindex="-1"></a>box <span class="ot">&lt;-</span> fish <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Fish <span class="sc">==</span> <span class="st">&quot;クロダイ属&quot;</span>  <span class="sc">&amp;</span></span>
<span id="cb56-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-3" tabindex="-1"></a>                  Period <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;1期&quot;</span>, <span class="st">&quot;2期&quot;</span>, <span class="st">&quot;3期&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb56-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-4" tabindex="-1"></a>                  Direction <span class="sc">==</span> <span class="st">&quot;左&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb56-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-5" tabindex="-1"></a>                  PML <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Period, <span class="at">y =</span> PML)) <span class="sc">+</span>   <span class="co"># `x =`でグループを設定</span></span>
<span id="cb56-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-7" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.5</span>, </span>
<span id="cb56-8"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-8" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb56-9"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-9" tabindex="-1"></a>  <span class="co"># 平均を描写する場合</span></span>
<span id="cb56-10"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-10" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean,</span>
<span id="cb56-11"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-11" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>,</span>
<span id="cb56-12"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-12" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb56-13"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-13" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">3.0</span>,</span>
<span id="cb56-14"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-14" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb56-15"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-15" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span>     </span>
<span id="cb56-16"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-16" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Archaeological Period&quot;</span>, <span class="at">y =</span> <span class="st">&quot;PML(mm)&quot;</span>) <span class="sc">+</span></span>
<span id="cb56-17"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-17" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb56-18"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-18" tabindex="-1"></a>  my_theme</span>
<span id="cb56-19"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-19" tabindex="-1"></a></span>
<span id="cb56-20"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb56-20" tabindex="-1"></a>box</span></code></pre></div>
<p><img src="chapters_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
</div>
<div id="バイオリンプロットシナプロット" class="section level3 hasAnchor" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> バイオリンプロット／シナプロット<a href="ggplot2を使用したデータビジュアライゼーション.html#バイオリンプロットシナプロット" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>バイオリンプロットはデータの分布を視覚的に表現するためのグラフです。5つの要約統計量を示す箱ひげ図よりも詳細な分布を知ることができます。バイオリンプロットは<code>カーネル密度推定</code>を用いて滑らかな曲線で表現されます。Leland Wilkinson氏が1999年に論文”Dot plots”で発表したグラフです<span class="citation">(Wilkinson, 1999)</span>。</p>
<p>シナプロットはバイオリンプロットと同じくデータの分布を可視化するためのグラフで、個々のデータをポイントで表示することができます。<a href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a>でも<a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html"><code>ggplot2::geom_jitter</code></a>を使えば軸に幅を持たせて点をランダムに配置したグラフ（ジッタープロット）を描写することができますが、シナプロットはデータの密度分布に沿ってジッターの幅が制御され、データの数・密度分布・外れ値・広がりの情報がよりわかりやすくなっています。Nikos Sidiropoulos氏やSina Hadi Sohi氏らが2018年に論文”SinaPlot: An Enhanced Chart for Simple and Truthful Representation of Single Observations Over Multiple Classes”で発表しました<span class="citation">(Sidiropoulos et al., 2018)</span>。</p>
<p>バイオリンプロットは<a href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a>の<a href="https://ggplot2.tidyverse.org/reference/geom_violin.html"><code>ggplot2::geom_violin()</code></a>を用いて、<a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html?q=boxplot#null"><code>ggplot2::geom_boxplot()</code></a>と同じような使い方ができます（図<a href="ggplot2を使用したデータビジュアライゼーション.html#fig:violin">4.12</a>）。シナプロットは<a href="https://ggforce.data-imaginist.com"><code>ggforce</code></a>パッケージの<a href="https://ggforce.data-imaginist.com/reference/geom_sina.html"><code>ggforce::geom_sina()</code></a>で実装することができます（図<a href="ggplot2を使用したデータビジュアライゼーション.html#fig:sina">4.13</a>）。バイオリンプロットとシナプロットともに、箱ひげ図などの他のグラフと組み合わせることも可能です（図<a href="ggplot2を使用したデータビジュアライゼーション.html#fig:box-violin-sina">4.14</a>）。</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb57-1" tabindex="-1"></a><span class="do">#### バイオリンプロット ####</span></span>
<span id="cb57-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb57-2" tabindex="-1"></a>violin <span class="ot">&lt;-</span> fish <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb57-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Fish <span class="sc">==</span> <span class="st">&quot;クロダイ属&quot;</span>  <span class="sc">&amp;</span></span>
<span id="cb57-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb57-4" tabindex="-1"></a>                  Period <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;1期&quot;</span>, <span class="st">&quot;2期&quot;</span>, <span class="st">&quot;3期&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb57-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb57-5" tabindex="-1"></a>                  Direction <span class="sc">==</span> <span class="st">&quot;左&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb57-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb57-6" tabindex="-1"></a>                  PML <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb57-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Period, <span class="at">y =</span> PML)) <span class="sc">+</span></span>
<span id="cb57-8"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb57-8" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">trim =</span> <span class="cn">FALSE</span>,</span>
<span id="cb57-9"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb57-9" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-10"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb57-10" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Archaeological Period&quot;</span>, <span class="at">y =</span> <span class="st">&quot;PML(mm)&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-11"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb57-11" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb57-12"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb57-12" tabindex="-1"></a>  my_theme</span>
<span id="cb57-13"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb57-13" tabindex="-1"></a></span>
<span id="cb57-14"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb57-14" tabindex="-1"></a>violin</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:violin"></span>
<img src="chapters_files/figure-html/violin-1.png" alt="バイオリンプロット" width="672" />
<p class="caption">
図 4.12: バイオリンプロット
</p>
</div>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-1" tabindex="-1"></a><span class="do">#### ジッタープロット ####</span></span>
<span id="cb58-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-2" tabindex="-1"></a>jitter <span class="ot">&lt;-</span> fish <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Fish <span class="sc">==</span> <span class="st">&quot;クロダイ属&quot;</span>  <span class="sc">&amp;</span></span>
<span id="cb58-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-4" tabindex="-1"></a>                  Period <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;1期&quot;</span>, <span class="st">&quot;2期&quot;</span>, <span class="st">&quot;3期&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb58-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-5" tabindex="-1"></a>                  Direction <span class="sc">==</span> <span class="st">&quot;左&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb58-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-6" tabindex="-1"></a>                  PML <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Period, <span class="at">y =</span> PML)) <span class="sc">+</span></span>
<span id="cb58-8"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-8" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb58-9"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Archaeological Period&quot;</span>, <span class="at">y =</span> <span class="st">&quot;PML(mm)&quot;</span>) <span class="sc">+</span></span>
<span id="cb58-10"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-10" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb58-11"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-11" tabindex="-1"></a>  my_theme</span>
<span id="cb58-12"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-12" tabindex="-1"></a></span>
<span id="cb58-13"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-13" tabindex="-1"></a><span class="do">#### シナプロット ####</span></span>
<span id="cb58-14"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-14" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggforce&quot;</span>)</span>
<span id="cb58-15"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-15" tabindex="-1"></a></span>
<span id="cb58-16"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-16" tabindex="-1"></a>sina <span class="ot">&lt;-</span> fish <span class="sc">%&gt;%</span></span>
<span id="cb58-17"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Fish <span class="sc">==</span> <span class="st">&quot;クロダイ属&quot;</span>  <span class="sc">&amp;</span></span>
<span id="cb58-18"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-18" tabindex="-1"></a>                  Period <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;1期&quot;</span>, <span class="st">&quot;2期&quot;</span>, <span class="st">&quot;3期&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb58-19"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-19" tabindex="-1"></a>                  Direction <span class="sc">==</span> <span class="st">&quot;左&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb58-20"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-20" tabindex="-1"></a>                  PML <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-21"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-21" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Period, <span class="at">y =</span> PML)) <span class="sc">+</span></span>
<span id="cb58-22"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-22" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">geom_sina</span>() <span class="sc">+</span></span>
<span id="cb58-23"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-23" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Archaeological Period&quot;</span>, <span class="at">y =</span> <span class="st">&quot;PML(mm)&quot;</span>) <span class="sc">+</span></span>
<span id="cb58-24"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-24" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb58-25"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-25" tabindex="-1"></a>  my_theme</span>
<span id="cb58-26"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-26" tabindex="-1"></a></span>
<span id="cb58-27"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-27" tabindex="-1"></a>jitter</span>
<span id="cb58-28"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb58-28" tabindex="-1"></a>sina</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:sina"></span>
<img src="chapters_files/figure-html/sina-1.png" alt="ジッタープロット（左）とシナプロット（右）" width="48%" /><img src="chapters_files/figure-html/sina-2.png" alt="ジッタープロット（左）とシナプロット（右）" width="48%" />
<p class="caption">
図 4.13: ジッタープロット（左）とシナプロット（右）
</p>
</div>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-1" tabindex="-1"></a><span class="do">#### 箱ひげ図にバイオリンプロットとシナプロットを重ねる ####</span></span>
<span id="cb59-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-2" tabindex="-1"></a>box_violin_sina <span class="ot">&lt;-</span> fish <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Fish <span class="sc">==</span> <span class="st">&quot;クロダイ属&quot;</span>  <span class="sc">&amp;</span></span>
<span id="cb59-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-4" tabindex="-1"></a>                  Period <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;1期&quot;</span>, <span class="st">&quot;2期&quot;</span>, <span class="st">&quot;3期&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb59-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-5" tabindex="-1"></a>                  Direction <span class="sc">==</span> <span class="st">&quot;左&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb59-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-6" tabindex="-1"></a>                  PML <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb59-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Period, <span class="at">y =</span> PML)) <span class="sc">+</span></span>
<span id="cb59-8"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-8" tabindex="-1"></a>  <span class="co"># バイオリンプロットを描写</span></span>
<span id="cb59-9"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-9" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">trim =</span> <span class="cn">FALSE</span>,</span>
<span id="cb59-10"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-10" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb59-11"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-11" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">&quot;blank&quot;</span>,    <span class="co"># 確率密度曲線の枠線をなしに。</span></span>
<span id="cb59-12"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-12" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span>         <span class="co"># fillの透明度を設定する。</span></span>
<span id="cb59-13"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-13" tabindex="-1"></a>  <span class="co"># 箱ひげ図を追加</span></span>
<span id="cb59-14"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-14" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.3</span>,</span>
<span id="cb59-15"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-15" tabindex="-1"></a>               <span class="at">outliers =</span> <span class="cn">FALSE</span>,      <span class="co"># 外れ値の描写</span></span>
<span id="cb59-16"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-16" tabindex="-1"></a>               ) <span class="sc">+</span></span>
<span id="cb59-17"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-17" tabindex="-1"></a>  <span class="co"># シナプロットを追加</span></span>
<span id="cb59-18"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-18" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">geom_sina</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>,</span>
<span id="cb59-19"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-19" tabindex="-1"></a>                     <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-20"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-20" tabindex="-1"></a>  <span class="co"># 平均や中央値を描写する場合、`stat_summary()`を使えば良い。</span></span>
<span id="cb59-21"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-21" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean,</span>
<span id="cb59-22"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-22" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>,</span>
<span id="cb59-23"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-23" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb59-24"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-24" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">2.0</span>,</span>
<span id="cb59-25"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-25" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb59-26"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-26" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span>     </span>
<span id="cb59-27"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-27" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Archaeological Period&quot;</span>, <span class="at">y =</span> <span class="st">&quot;PML(mm)&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-28"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-28" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb59-29"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-29" tabindex="-1"></a>  my_theme</span>
<span id="cb59-30"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-30" tabindex="-1"></a></span>
<span id="cb59-31"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb59-31" tabindex="-1"></a>box_violin_sina</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:box-violin-sina"></span>
<img src="chapters_files/figure-html/box-violin-sina-1.png" alt="箱ひげ図と重ねて表示" width="672" />
<p class="caption">
図 4.14: 箱ひげ図と重ねて表示
</p>
</div>
</div>
</div>
<div id="折れ線グラフ" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> 折れ線グラフ<a href="ggplot2を使用したデータビジュアライゼーション.html#折れ線グラフ" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>折れ線グラフは<a href="https://ggplot2.tidyverse.org/reference/geom_path.html"><code>ggplot2::geom_line</code></a>で描写することができます。今回は、COVID-19の感染者数のデータを利用して、一月ごとの感染者数の推移がわかるようなグラフを作成します。データには<a href="https://www.mhlw.go.jp/stf/covid-19/open-data.html">厚生労働省のホームページ</a>で「新規陽性者数の推移（日別）」が公開されているのでこれをダウンロードします。</p>
<p>このデータは横長型のデータなので、まず縦長型の<code>tidy data</code>に変換します。</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb60-1" tabindex="-1"></a><span class="co"># データの読み込み</span></span>
<span id="cb60-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb60-2" tabindex="-1"></a>covid19 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;analysis/data/newly_confirmed_cases_daily.csv&quot;</span>)</span>
<span id="cb60-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb60-3" tabindex="-1"></a>covid19 <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 49
##   Date        ALL Hokkaido Aomori Iwate Miyagi Akita Yamagata Fukushima Ibaraki
##   &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 2020/1/16     1        0      0     0      0     0        0         0       0
## 2 2020/1/17     0        0      0     0      0     0        0         0       0
## 3 2020/1/18     0        0      0     0      0     0        0         0       0
## 4 2020/1/19     0        0      0     0      0     0        0         0       0
## 5 2020/1/20     0        0      0     0      0     0        0         0       0
## 6 2020/1/21     0        0      0     0      0     0        0         0       0
## # ℹ 39 more variables: Tochigi &lt;dbl&gt;, Gunma &lt;dbl&gt;, Saitama &lt;dbl&gt;, Chiba &lt;dbl&gt;,
## #   Tokyo &lt;dbl&gt;, Kanagawa &lt;dbl&gt;, Niigata &lt;dbl&gt;, Toyama &lt;dbl&gt;, Ishikawa &lt;dbl&gt;,
## #   Fukui &lt;dbl&gt;, Yamanashi &lt;dbl&gt;, Nagano &lt;dbl&gt;, Gifu &lt;dbl&gt;, Shizuoka &lt;dbl&gt;,
## #   Aichi &lt;dbl&gt;, Mie &lt;dbl&gt;, Shiga &lt;dbl&gt;, Kyoto &lt;dbl&gt;, Osaka &lt;dbl&gt;, Hyogo &lt;dbl&gt;,
## #   Nara &lt;dbl&gt;, Wakayama &lt;dbl&gt;, Tottori &lt;dbl&gt;, Shimane &lt;dbl&gt;, Okayama &lt;dbl&gt;,
## #   Hiroshima &lt;dbl&gt;, Yamaguchi &lt;dbl&gt;, Tokushima &lt;dbl&gt;, Kagawa &lt;dbl&gt;,
## #   Ehime &lt;dbl&gt;, Kochi &lt;dbl&gt;, Fukuoka &lt;dbl&gt;, Saga &lt;dbl&gt;, Nagasaki &lt;dbl&gt;, …</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb62-1" tabindex="-1"></a><span class="co"># 横長型のデータを縦長型（tidy data）に変換</span></span>
<span id="cb62-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb62-2" tabindex="-1"></a>covid19_tidy <span class="ot">&lt;-</span> covid19 <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb62-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>ALL) <span class="sc">%&gt;%</span>   <span class="co"># 不要な列の削除</span></span>
<span id="cb62-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb62-4" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span>Date, 　　<span class="co"># `!`で動かさないデータを指定</span></span>
<span id="cb62-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb62-5" tabindex="-1"></a>                      <span class="at">names_to =</span> <span class="st">&quot;pref&quot;</span>,</span>
<span id="cb62-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb62-6" tabindex="-1"></a>                      <span class="at">values_to =</span> <span class="st">&quot;infected&quot;</span>)</span>
<span id="cb62-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb62-7" tabindex="-1"></a>covid19_tidy <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   Date      pref     infected
##   &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;
## 1 2020/1/16 Hokkaido        0
## 2 2020/1/16 Aomori          0
## 3 2020/1/16 Iwate           0
## 4 2020/1/16 Miyagi          0
## 5 2020/1/16 Akita           0
## 6 2020/1/16 Yamagata        0</code></pre>
<p>変形したデータを<a href="https://dplyr.tidyverse.org/reference/summarise.html"><code>dplyr::summarize()</code></a>関数で、週ごとの合計を算出したのちにグラフを作成します。詳しくは<a href="データの編集.html#概要表">「<code>summarize()</code>による概要表」</a>を参照してください。</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-1" tabindex="-1"></a><span class="do">#### lubridateパッケージを使って日付型に変換。####</span></span>
<span id="cb64-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;lubridate&quot;</span>)</span>
<span id="cb64-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-3" tabindex="-1"></a></span>
<span id="cb64-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-4" tabindex="-1"></a><span class="co"># `lubridate::ymd()`で日付型にする。`dmy()`や`mdy()`もある。</span></span>
<span id="cb64-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-5" tabindex="-1"></a>covid19_tidy <span class="ot">&lt;-</span> covid19_tidy <span class="sc">%&gt;%</span></span>
<span id="cb64-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(Date, lubridate<span class="sc">::</span>ymd))</span>
<span id="cb64-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-7" tabindex="-1"></a></span>
<span id="cb64-8"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-8" tabindex="-1"></a><span class="do">#### データを編集する ####</span></span>
<span id="cb64-9"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-9" tabindex="-1"></a><span class="co"># `lubridate::floor_date`で週ごとのデータにする。</span></span>
<span id="cb64-10"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-10" tabindex="-1"></a>covid19_tidy <span class="ot">&lt;-</span> covid19_tidy <span class="sc">%&gt;%</span></span>
<span id="cb64-11"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">week_start =</span> lubridate<span class="sc">::</span><span class="fu">floor_date</span>(Date, <span class="at">unit =</span> <span class="st">&quot;month&quot;</span>))</span>
<span id="cb64-12"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-12" tabindex="-1"></a></span>
<span id="cb64-13"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-13" tabindex="-1"></a><span class="co"># `dplyr::summarize`で週ごとの合計を算出。</span></span>
<span id="cb64-14"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-14" tabindex="-1"></a>covid19_monthly <span class="ot">&lt;-</span> covid19_tidy <span class="sc">%&gt;%</span></span>
<span id="cb64-15"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(week_start) <span class="sc">%&gt;%</span></span>
<span id="cb64-16"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(infected),</span>
<span id="cb64-17"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-17" tabindex="-1"></a>                   <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>)</span>
<span id="cb64-18"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-18" tabindex="-1"></a></span>
<span id="cb64-19"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb64-19" tabindex="-1"></a>covid19_monthly <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   week_start total
##   &lt;date&gt;     &lt;dbl&gt;
## 1 2020-01-01    14
## 2 2020-02-01   213
## 3 2020-03-01  1936
## 4 2020-04-01 11952
## 5 2020-05-01  2439
## 6 2020-06-01  1741</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb66-1" tabindex="-1"></a><span class="co"># 折れ線グラフを描写する。</span></span>
<span id="cb66-2"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb66-2" tabindex="-1"></a>covid19_monthly <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb66-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> week_start,</span>
<span id="cb66-4"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb66-4" tabindex="-1"></a>                      <span class="at">y =</span> total)) <span class="sc">+</span></span>
<span id="cb66-5"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb66-5" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span>                                 <span class="co"># 折れ線グラフの表示</span></span>
<span id="cb66-6"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb66-6" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.9</span>) <span class="sc">+</span>                      <span class="co"># ポイントを表示する</span></span>
<span id="cb66-7"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb66-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;月&quot;</span>, <span class="at">y =</span> <span class="st">&quot;感染者数&quot;</span>) <span class="sc">+</span></span>
<span id="cb66-8"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb66-8" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">&quot;3 month&quot;</span>,</span>
<span id="cb66-9"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb66-9" tabindex="-1"></a>               <span class="at">date_labels =</span> <span class="st">&quot;%Y-%m&quot;</span>) <span class="sc">+</span>         <span class="co"># x軸の表示方法を変更する</span></span>
<span id="cb66-10"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb66-10" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span>  <span class="co"># 数字にカンマを入れる</span></span>
<span id="cb66-11"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb66-11" tabindex="-1"></a>  my_theme <span class="sc">+</span></span>
<span id="cb66-12"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb66-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, </span>
<span id="cb66-13"><a href="ggplot2を使用したデータビジュアライゼーション.html#cb66-13" tabindex="-1"></a>                                   <span class="at">hjust =</span> <span class="dv">1</span>))  <span class="co"># x軸のラベルを45度回転させる </span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:line"></span>
<img src="chapters_files/figure-html/line-1.png" alt="折れ線グラフ" width="672" />
<p class="caption">
図 4.15: 折れ線グラフ
</p>
</div>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>統計学者Francis Anscombe氏のAnscombe’s quartet（「アンスコムの例」）<span class="citation">(Anscombe, 1973)</span>に因んで命名された。<a href="ggplot2を使用したデータビジュアライゼーション.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>データを4つに分割した際に下からちょうど1/4にあるデータを「第1四分位数」、2/4にあるデータを「第2四分位数」（中央値）、3/4のところのデータを「第3四分位数」といい、これらを「四分位数」といいます。<a href="ggplot2を使用したデータビジュアライゼーション.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="データの編集.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="引用参考文献.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
